<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alias - –°–ª–æ–≤–µ—Å–Ω–∞—è –∏–≥—Ä–∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff6b6b;
            --success-color: #40c057;
            --danger-color: #fa5252;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7ff;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .screen {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .screen.active {
            display: block;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            margin: 0.5rem;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-secondary {
            background-color: #868e96;
        }
        
        .player-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
        }
        
        #playerNameInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        #playerNameInput:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
        }
        
        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 1.5rem 0;
        }
        
        .player-item {
            background-color: #e9ecef;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-item:hover {
            background-color: #dbe4ff;
            color: var(--primary-color);
        }
        
        .player-item .remove-player {
            color: #868e96;
            font-weight: bold;
            font-size: 1.2rem;
            line-height: 1;
        }
        
        .teams-container {
            display: flex;
            gap: 20px;
            margin-bottom: 1.5rem;
        }
        
        .team {
            flex: 1;
            min-height: 200px;
            border: 2px dashed #ced4da;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            background-color: white;
            transition: var(--transition);
        }
        
        .team.active {
            border-color: var(--primary-color);
            background-color: #f8f9ff;
        }
        
        .team h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .word-display {
            font-size: 2.5rem;
            text-align: center;
            margin: 2rem 0;
            min-height: 60px;
            font-weight: 700;
            color: var(--dark-color);
            padding: 1.5rem;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .timer {
            font-size: 3.5rem;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--danger-color);
            font-weight: 700;
        }
        
        .scoreboard {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 1.5rem 0;
        }
        
        .scoreboard.compact {
            gap: 8px;
        }
        
        .player-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-radius: 50px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .player-score:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .player-score .name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }
        
        .player-score .score {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .team-score {
            text-align: center;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            background-color: white;
            box-shadow: var(--box-shadow);
        }
        
        .current-players {
            text-align: center;
            font-size: 1.3rem;
            margin: 1.5rem 0;
            color: var(--dark-color);
            font-weight: 500;
        }
        
        .category-select {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            margin: 1.5rem 0;
        }
        
        .category-btn {
            padding: 1rem;
            background-color: white;
            border: 2px solid #dee2e6;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            text-align: center;
        }
        
        .category-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .category-btn.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .select-all-categories {
            grid-column: 1 / -1;
            text-align: center;
            margin: 1rem 0;
        }
        
        .full-results-btn {
            display: block;
            margin: 1rem auto;
            background-color: #7950f2;
        }
        
        .game-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
        }
        
        .winner-screen {
            text-align: center;
            padding: 2rem;
        }
        
        .winner-name {
            font-size: 2.5rem;
            color: var(--success-color);
            margin: 1.5rem 0;
            font-weight: 700;
        }
        
        .rounds-selector {
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .rounds-selector input {
            width: 80px;
            padding: 12px;
            font-size: 1rem;
            text-align: center;
            border: 2px solid #dee2e6;
            border-radius: var(--border-radius);
            font-weight: 500;
        }
        
        .rounds-info {
            font-size: 0.9rem;
            color: #868e96;
            margin-top: 0.5rem;
        }
        
        .game-mode-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 1.5rem 0;
        }
        
        .game-mode-selector label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        .game-mode-selector label:hover {
            background-color: #f1f3f5;
        }
        
        .game-mode-selector input[type="radio"] {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #adb5bd;
            border-radius: 50%;
            transition: var(--transition);
            position: relative;
        }
        
        .game-mode-selector input[type="radio"]:checked {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
        }
        
        .game-mode-selector input[type="radio"]:checked::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .screen {
                padding: 1.5rem;
            }
            
            .teams-container {
                flex-direction: column;
            }
            
            .category-select {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .word-display {
                font-size: 2rem;
                padding: 1rem;
            }
            
            .timer {
                font-size: 3rem;
            }
            
            .player-score {
                padding: 10px 15px;
            }
            
            .game-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .game-buttons button {
                width: 100%;
                max-width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .player-input-container {
                flex-direction: column;
            }
            
            .category-select {
                grid-template-columns: 1fr;
            }
            
            .word-display {
                font-size: 1.8rem;
            }
            
            .timer {
                font-size: 2.5rem;
            }
        }
        
        /* Animation for word display */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .word-display.new-word {
            animation: pulse 0.5s ease;
        }
        
        /* Badge for current player */
        .current-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Alias - –°–ª–æ–≤–µ—Å–Ω–∞—è –∏–≥—Ä–∞</h1>
        
        <!-- Player Setup Screen -->
        <div id="playerSetupScreen" class="screen active">
            <h2>–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä–æ–∫–æ–≤</h2>
            <div class="player-input-container">
                <input type="text" id="playerNameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞" autofocus>
                <button id="addPlayerBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div class="player-list" id="playerList"></div>
            
            <div class="game-mode-selector">
                <label>
                    <input type="radio" name="gameMode" value="individual" checked>
                    <span>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞</span>
                </label>
                <label>
                    <input type="radio" name="gameMode" value="teams">
                    <span>–ö–æ–º–∞–Ω–¥–Ω–∞—è –∏–≥—Ä–∞</span>
                </label>
            </div>
            
            <div id="teamSetup" style="display: none;">
                <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º</h3>
                <div class="teams-container">
                    <div class="team" id="team1">
                        <h3>–ö–æ–º–∞–Ω–¥–∞ 1</h3>
                    </div>
                    <div class="team" id="team2">
                        <h3>–ö–æ–º–∞–Ω–¥–∞ 2</h3>
                    </div>
                </div>
            </div>
            
            <div class="rounds-selector" id="roundsSelector">
                <h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤:</h3>
                <input type="number" id="roundsInput" min="1" value="3">
                <div class="rounds-info" id="roundsInfo"></div>
                <p id="roundsWarning" style="color: var(--danger-color); display: none;"></p>
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <button id="nextToCategoriesBtn" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- Category Selection Screen -->
        <div id="categoryScreen" class="screen">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –°–ª–æ–≤–∞ –±—É–¥—É—Ç –±—Ä–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.</p>
            <div class="category-select" id="categorySelect">
                <!-- Categories will be loaded from JSON -->
            </div>
            <div class="select-all-categories">
                <button id="toggleAllCategoriesBtn">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <button id="startGameBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="scoreboard compact" id="scoreboard">
                <!-- Scores will be displayed here -->
            </div>
            <button id="showFullResultsBtn" class="full-results-btn" style="display: none;">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            
            <div class="current-players" id="currentPlayers">
                <!-- Current players will be displayed here -->
            </div>
            
            <div class="timer" id="timer">01:00</div>
            
            <div class="word-display" id="wordDisplay"></div>
            
            <div class="game-buttons">
                <button id="correctBtn" class="btn-success">–ü—Ä–∞–≤–∏–ª—å–Ω–æ (+1)</button>
                <button id="skipBtn" class="btn-danger">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (-1)</button>
            </div>
        </div>
        
        <!-- Winner Screen -->
        <div id="winnerScreen" class="screen">
            <div class="winner-screen">
                <h2>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                <p style="font-size: 1.2rem; color: #666;">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:</p>
                <div class="winner-name" id="winnerName"></div>
                <div class="scoreboard" id="finalScoreboard"></div>
                <div style="margin-top: 2rem;">
                    <button id="playAgainBtn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            players: [],
            teams: [[], []],
            gameMode: 'individual',
            categories: {},
            selectedCategories: [],
            currentWord: '',
            guessedWords: [],
            allWords: [],
            remainingWords: [],
            score: {},
            timer: null,
            timeLeft: 60,
            currentRound: 0,
            totalRounds: 3,
            currentTeamIndex: 0,
            currentExplainer: null,
            currentGuesser: null,
            currentTeam: null,
            roundsPerPlayer: 0,
            showFullResults: false
        };

        // DOM elements
        const elements = {
            playerSetupScreen: document.getElementById('playerSetupScreen'),
            categoryScreen: document.getElementById('categoryScreen'),
            gameScreen: document.getElementById('gameScreen'),
            winnerScreen: document.getElementById('winnerScreen'),
            playerNameInput: document.getElementById('playerNameInput'),
            addPlayerBtn: document.getElementById('addPlayerBtn'),
            playerList: document.getElementById('playerList'),
            nextToCategoriesBtn: document.getElementById('nextToCategoriesBtn'),
            teamSetup: document.getElementById('teamSetup'),
            team1: document.getElementById('team1'),
            team2: document.getElementById('team2'),
            categorySelect: document.getElementById('categorySelect'),
            toggleAllCategoriesBtn: document.getElementById('toggleAllCategoriesBtn'),
            startGameBtn: document.getElementById('startGameBtn'),
            scoreboard: document.getElementById('scoreboard'),
            showFullResultsBtn: document.getElementById('showFullResultsBtn'),
            finalScoreboard: document.getElementById('finalScoreboard'),
            currentPlayers: document.getElementById('currentPlayers'),
            timer: document.getElementById('timer'),
            wordDisplay: document.getElementById('wordDisplay'),
            correctBtn: document.getElementById('correctBtn'),
            skipBtn: document.getElementById('skipBtn'),
            winnerName: document.getElementById('winnerName'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            gameModeRadios: document.querySelectorAll('input[name="gameMode"]'),
            roundsInput: document.getElementById('roundsInput'),
            roundsWarning: document.getElementById('roundsWarning'),
            roundsInfo: document.getElementById('roundsInfo'),
            roundsSelector: document.getElementById('roundsSelector')
        };

        // Initialize the game
        async function init() {
            // Load categories from JSON file
            await loadCategories();
            
            // Event listeners
            elements.addPlayerBtn.addEventListener('click', addPlayer);
            elements.playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addPlayer();
            });
            
            // Keep focus on input after adding player
            elements.addPlayerBtn.addEventListener('click', () => {
                elements.playerNameInput.focus();
            });
            
            elements.nextToCategoriesBtn.addEventListener('click', showCategoryScreen);
            elements.startGameBtn.addEventListener('click', startGame);
            elements.toggleAllCategoriesBtn.addEventListener('click', toggleAllCategories);
            elements.correctBtn.addEventListener('click', wordGuessed);
            elements.skipBtn.addEventListener('click', skipWord);
            elements.playAgainBtn.addEventListener('click', resetGame);
            elements.showFullResultsBtn.addEventListener('click', toggleFullResults);
            
            // Game mode change
            elements.gameModeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    gameState.gameMode = e.target.value;
                    elements.teamSetup.style.display = gameState.gameMode === 'teams' ? 'flex' : 'none';
                    if (gameState.gameMode === 'teams' && gameState.players.length > 0) {
                        autoDistributeTeams();
                    }
                    updateRoundsInput();
                });
            });
            
            // Rounds input change
            elements.roundsInput.addEventListener('change', updateRoundsInput);
        }

        // Load categories from JSON file
        async function loadCategories() {
            try {
                const response = await fetch('categories.json');
                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å categories.json');
                }
                gameState.categories = await response.json();
                console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', gameState.categories);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª categories.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.');
            }
        }

        // Toggle all categories selection
        function toggleAllCategories() {
            const allSelected = gameState.selectedCategories.length === Object.keys(gameState.categories).length;
            
            if (allSelected) {
                // Deselect all
                gameState.selectedCategories = [];
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                elements.toggleAllCategoriesBtn.textContent = '–í—ã–±—Ä–∞—Ç—å –≤—Å–µ';
            } else {
                // Select all
                gameState.selectedCategories = Object.keys(gameState.categories);
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.add('selected');
                });
                elements.toggleAllCategoriesBtn.textContent = '–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ';
            }
        }

        // Automatically distribute players to teams
        function autoDistributeTeams() {
            // Clear teams
            elements.team1.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 1</h3>';
            elements.team2.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 2</h3>';
            gameState.teams = [[], []];
            
            // Shuffle players
            const shuffledPlayers = [...gameState.players].sort(() => Math.random() - 0.5);
            
            // Distribute players
            shuffledPlayers.forEach((player, index) => {
                const teamIndex = index % 2;
                const teamElement = teamIndex === 0 ? elements.team1 : elements.team2;
                
                const playerElement = document.createElement('div');
                playerElement.className = 'player-item';
                playerElement.innerHTML = `
                    ${player}
                    <span class="remove-player" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É">‚Üî</span>
                `;
                playerElement.addEventListener('click', () => movePlayerToOtherTeam(player));
                
                teamElement.appendChild(playerElement);
                gameState.teams[teamIndex].push(player);
            });
            
            // Enable continue button if we have at least 2 players
            elements.nextToCategoriesBtn.disabled = gameState.players.length < 2;
        }

        // Move player to other team
        function movePlayerToOtherTeam(playerName) {
            const team1Index = gameState.teams[0].indexOf(playerName);
            const team2Index = gameState.teams[1].indexOf(playerName);
            
            if (team1Index >= 0) {
                // Move from team 1 to team 2
                gameState.teams[0].splice(team1Index, 1);
                gameState.teams[1].push(playerName);
            } else if (team2Index >= 0) {
                // Move from team 2 to team 1
                gameState.teams[1].splice(team2Index, 1);
                gameState.teams[0].push(playerName);
            }
            
            // Update UI
            renderTeams();
        }

        // Render teams in UI
        function renderTeams() {
            elements.team1.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 1</h3>';
            elements.team2.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 2</h3>';
            
            gameState.teams[0].forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = 'player-item';
                playerElement.innerHTML = `
                    ${player}
                    <span class="remove-player" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É">‚Üî</span>
                `;
                playerElement.addEventListener('click', () => movePlayerToOtherTeam(player));
                elements.team1.appendChild(playerElement);
            });
            
            gameState.teams[1].forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = 'player-item';
                playerElement.innerHTML = `
                    ${player}
                    <span class="remove-player" title="–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É">‚Üî</span>
                `;
                playerElement.addEventListener('click', () => movePlayerToOtherTeam(player));
                elements.team2.appendChild(playerElement);
            });
        }

        // Update rounds input based on game mode and player count
        function updateRoundsInput() {
            const numPlayers = gameState.players.length;
            if (numPlayers < 2) {
                elements.roundsInfo.textContent = '';
                elements.roundsWarning.style.display = 'none';
                return;
            }
            
            if (gameState.gameMode === 'individual') {
                // For individual mode, rounds must be multiple of players (or players*2 for odd counts)
                const baseRounds = numPlayers % 2 === 0 ? numPlayers : numPlayers * 2;
                const currentValue = parseInt(elements.roundsInput.value);
                
                elements.roundsInput.min = baseRounds;
                elements.roundsInput.step = baseRounds;
                
                if (currentValue % baseRounds !== 0) {
                    elements.roundsInput.value = baseRounds;
                }
                
                elements.roundsInfo.textContent = `–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: ${baseRounds} —Ä–∞—É–Ω–¥–æ–≤ (–∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –æ–±—ä—è—Å–Ω–∏—Ç ${numPlayers % 2 === 0 ? 2 : 4} —Ä–∞–∑–∞)`;
                elements.roundsWarning.style.display = 'none';
            } else {
                // For team mode, rounds must be even
                const currentValue = parseInt(elements.roundsInput.value);
                const minRounds = 2;
                
                elements.roundsInput.min = minRounds;
                elements.roundsInput.step = 2;
                
                if (currentValue % 2 !== 0) {
                    elements.roundsInput.value = minRounds;
                }
                
                elements.roundsInfo.textContent = `–ß–∏—Å–ª–æ —Ä–∞—É–Ω–¥–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç–Ω—ã–º`;
                elements.roundsWarning.style.display = 'none';
            }
        }

        // Add a player to the game
        function addPlayer() {
            const name = elements.playerNameInput.value.trim();
            if (name && !gameState.players.includes(name)) {
                gameState.players.push(name);
                
                const playerElement = document.createElement('div');
                playerElement.className = 'player-item';
                playerElement.innerHTML = `
                    ${name}
                    <span class="remove-player" title="–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞">√ó</span>
                `;
                
                // Add click handler for removing player
                playerElement.addEventListener('click', (e) => {
                    if (e.target.classList.contains('remove-player')) {
                        removePlayer(name);
                        return;
                    }
                    
                    if (gameState.gameMode === 'teams') {
                        movePlayerToOtherTeam(name);
                    }
                });
                
                elements.playerList.appendChild(playerElement);
                elements.playerNameInput.value = '';
                
                // Enable continue button if we have at least 2 players
                if (gameState.players.length >= 2) {
                    elements.nextToCategoriesBtn.disabled = false;
                    
                    // Auto-distribute teams if in team mode
                    if (gameState.gameMode === 'teams') {
                        autoDistributeTeams();
                    }
                }
                
                // Update rounds input validation
                updateRoundsInput();
                
                // Keep focus on input
                elements.playerNameInput.focus();
            }
        }

        // Remove player from game
        function removePlayer(name) {
            // Remove from players list
            gameState.players = gameState.players.filter(player => player !== name);
            
            // Remove from teams if in team mode
            if (gameState.gameMode === 'teams') {
                gameState.teams[0] = gameState.teams[0].filter(player => player !== name);
                gameState.teams[1] = gameState.teams[1].filter(player => player !== name);
                renderTeams();
            }
            
            // Remove from UI
            const playerElements = document.querySelectorAll('.player-item');
            playerElements.forEach(el => {
                if (el.textContent.includes(name)) {
                    el.remove();
                }
            });
            
            // Update rounds input
            updateRoundsInput();
            
            // Disable continue button if less than 2 players
            if (gameState.players.length < 2) {
                elements.nextToCategoriesBtn.disabled = true;
            }
        }

        // Show category selection screen
        function showCategoryScreen() {
            gameState.totalRounds = parseInt(elements.roundsInput.value);
            elements.playerSetupScreen.classList.remove('active');
            elements.categoryScreen.classList.add('active');
            populateCategories();
        }

        // Populate category selection
        function populateCategories() {
            elements.categorySelect.innerHTML = '';
            
            Object.keys(gameState.categories).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = category;
                btn.addEventListener('click', () => toggleCategorySelection(category));
                
                // Select by default if already selected
                if (gameState.selectedCategories.includes(category)) {
                    btn.classList.add('selected');
                }
                
                elements.categorySelect.appendChild(btn);
            });
            
            // Update toggle all button text
            elements.toggleAllCategoriesBtn.textContent = 
                gameState.selectedCategories.length === Object.keys(gameState.categories).length ? 
                '–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ' : '–í—ã–±—Ä–∞—Ç—å –≤—Å–µ';
        }

        // Toggle category selection
        function toggleCategorySelection(category) {
            const index = gameState.selectedCategories.indexOf(category);
            if (index === -1) {
                gameState.selectedCategories.push(category);
                event.target.classList.add('selected');
            } else {
                gameState.selectedCategories.splice(index, 1);
                event.target.classList.remove('selected');
            }
            
            // Update toggle all button text
            elements.toggleAllCategoriesBtn.textContent = 
                gameState.selectedCategories.length === Object.keys(gameState.categories).length ? 
                '–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ' : '–í—ã–±—Ä–∞—Ç—å –≤—Å–µ';
        }

        // Start the game
        function startGame() {
            if (gameState.selectedCategories.length === 0) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                return;
            }
            
            // Prepare words from selected categories
            gameState.allWords = [];
            gameState.selectedCategories.forEach(category => {
                if (gameState.categories[category]) {
                    gameState.allWords = gameState.allWords.concat(gameState.categories[category]);
                }
            });
            
            gameState.remainingWords = [...gameState.allWords];
            gameState.guessedWords = [];
            
            // Initialize scores
            if (gameState.gameMode === 'individual') {
                gameState.players.forEach(player => {
                    gameState.score[player] = 0;
                });
                // Calculate how many times each player will explain
                gameState.roundsPerPlayer = (gameState.totalRounds * 2) / gameState.players.length;
            } else {
                gameState.score = {
                    '–ö–æ–º–∞–Ω–¥–∞ 1': 0,
                    '–ö–æ–º–∞–Ω–¥–∞ 2': 0
                };
            }
            
            // Show game screen
            elements.categoryScreen.classList.remove('active');
            elements.gameScreen.classList.add('active');
            
            // Start the first round
            startRound();
        }

        // Start a new round
        function startRound() {
            gameState.currentRound++;
            gameState.guessedWords = [];
            
            // Update scoreboard
            updateScoreboard();
            
            // Select player/team for this round
            selectPlayerForRound();
            
            // Start the timer
            startTimer();
            
            // Show first word
            showNextWord();
            
            // Enable buttons
            elements.correctBtn.disabled = false;
            elements.skipBtn.disabled = false;
        }

        // Update the scoreboard display
        function updateScoreboard() {
            elements.scoreboard.innerHTML = '';
            
            if (gameState.gameMode === 'individual') {
                // Sort players by score
                const sortedPlayers = [...gameState.players].sort((a, b) => {
                    return (gameState.score[b] || 0) - (gameState.score[a] || 0);
                });
                
                // Show only top 3 in compact mode
                if (!gameState.showFullResults && sortedPlayers.length > 3) {
                    for (let i = 0; i < 3; i++) {
                        addPlayerToScoreboard(sortedPlayers[i]);
                    }
                    
                    // Add ellipsis
                    const ellipsis = document.createElement('div');
                    ellipsis.className = 'player-score';
                    ellipsis.style.justifyContent = 'center';
                    ellipsis.textContent = '...';
                    elements.scoreboard.appendChild(ellipsis);
                    
                    // Show toggle button
                    elements.showFullResultsBtn.style.display = 'block';
                } else {
                    // Show all players
                    sortedPlayers.forEach(player => {
                        addPlayerToScoreboard(player);
                    });
                    
                    // Hide toggle button
                    elements.showFullResultsBtn.style.display = 'none';
                }
            } else {
                ['–ö–æ–º–∞–Ω–¥–∞ 1', '–ö–æ–º–∞–Ω–¥–∞ 2'].forEach((team, index) => {
                    const scoreElement = document.createElement('div');
                    scoreElement.className = 'team-score';
                    scoreElement.innerHTML = `
                        <h3>${team}</h3>
                        <p>${gameState.teams[index].join(', ')}</p>
                        <p style="font-size: 1.5rem; font-weight: bold; margin-top: 0.5rem; color: var(--primary-color);">
                            ${gameState.score[team] || 0} –æ—á–∫–æ–≤
                        </p>
                    `;
                    elements.scoreboard.appendChild(scoreElement);
                });
            }
        }
        
        // Add player to scoreboard
        function addPlayerToScoreboard(player) {
            const scoreElement = document.createElement('div');
            scoreElement.className = 'player-score';
            
            const nameSpan = document.createElement('span');
            nameSpan.className = 'name';
            nameSpan.textContent = player;
            
            // Add badge for current explainer
            if (player === gameState.currentExplainer) {
                const badge = document.createElement('span');
                badge.className = 'current-badge';
                badge.textContent = '–û–±—ä—è—Å–Ω—è–µ—Ç';
                nameSpan.appendChild(badge);
            }
            // Add badge for current guesser
            else if (player === gameState.currentGuesser) {
                const badge = document.createElement('span');
                badge.className = 'current-badge';
                badge.textContent = '–û—Ç–≥–∞–¥—ã–≤–∞–µ—Ç';
                nameSpan.appendChild(badge);
            }
            
            const scoreSpan = document.createElement('span');
            scoreSpan.className = 'score';
            scoreSpan.textContent = gameState.score[player] || 0;
            
            scoreElement.appendChild(nameSpan);
            scoreElement.appendChild(scoreSpan);
            elements.scoreboard.appendChild(scoreElement);
        }

        // Toggle full results view
        function toggleFullResults() {
            gameState.showFullResults = !gameState.showFullResults;
            updateScoreboard();
        }

        // Select player/team for the current round
        function selectPlayerForRound() {
            if (gameState.gameMode === 'individual') {
                // For individual mode, select explainer and guesser
                const availablePlayers = [...gameState.players];
                
                // Select explainer
                const explainerIndex = (gameState.currentRound - 1) % gameState.players.length;
                gameState.currentExplainer = gameState.players[explainerIndex];
                
                // Select guesser (next player in list)
                const guesserIndex = (explainerIndex + 1) % gameState.players.length;
                gameState.currentGuesser = gameState.players[guesserIndex];
                
                elements.currentPlayers.textContent = `
                    <span style="font-weight: bold; color: var(--primary-color);">${gameState.currentExplainer}</span>
                    –æ–±—ä—è—Å–Ω—è–µ—Ç –¥–ª—è
                    <span style="font-weight: bold; color: var(--primary-color);">${gameState.currentGuesser}</span>
                `;
            } else {
                // For team mode, alternate between teams
                const teamIndex = gameState.currentTeamIndex;
                const teamName = `–ö–æ–º–∞–Ω–¥–∞ ${teamIndex + 1}`;
                const teamPlayers = gameState.teams[teamIndex];
                
                // Select random player from team
                const explainer = teamPlayers[Math.floor(Math.random() * teamPlayers.length)];
                
                gameState.currentTeam = teamName;
                gameState.currentExplainer = explainer;
                elements.currentPlayers.textContent = `
                    <span style="font-weight: bold; color: var(--primary-color);">${explainer}</span>
                    (<span style="font-weight: bold; color: var(--primary-color);">${teamName}</span>)
                    –æ–±—ä—è—Å–Ω—è–µ—Ç —Å–ª–æ–≤–∞
                `;
                
                // Alternate teams for next round
                gameState.currentTeamIndex = gameState.currentTeamIndex === 0 ? 1 : 0;
            }
        }

        // Start the timer
        function startTimer() {
            gameState.timeLeft = 60;
            updateTimerDisplay();
            
            clearInterval(gameState.timer);
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    endRound();
                }
            }, 1000);
        }

        // Update the timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            elements.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            if (gameState.timeLeft <= 10) {
                elements.timer.style.color = 'var(--danger-color)';
                elements.timer.style.animation = 'pulse 0.5s infinite alternate';
            } else {
                elements.timer.style.color = 'var(--primary-color)';
                elements.timer.style.animation = 'none';
            }
        }

        // Show the next word
        function showNextWord() {
            if (gameState.remainingWords.length === 0) {
                // If all words have been shown, reset the remaining words
                gameState.remainingWords = [...gameState.allWords];
                gameState.guessedWords = [];
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.remainingWords.length);
            gameState.currentWord = gameState.remainingWords[randomIndex];
            gameState.remainingWords.splice(randomIndex, 1);
            
            elements.wordDisplay.textContent = gameState.currentWord;
            elements.wordDisplay.classList.add('new-word');
            
            // Remove animation class after animation completes
            setTimeout(() => {
                elements.wordDisplay.classList.remove('new-word');
            }, 500);
        }

        // Word was guessed correctly
        function wordGuessed() {
            // Add to guessed words
            gameState.guessedWords.push(gameState.currentWord);
            
            // Update scores
            if (gameState.gameMode === 'individual') {
                // In individual mode, both players get points
                gameState.score[gameState.currentExplainer] = (gameState.score[gameState.currentExplainer] || 0) + 1;
                gameState.score[gameState.currentGuesser] = (gameState.score[gameState.currentGuesser] || 0) + 1;
            } else {
                // In team mode, add point to current team
                gameState.score[gameState.currentTeam] = (gameState.score[gameState.currentTeam] || 0) + 1;
            }
            
            // Update scoreboard
            updateScoreboard();
            
            // Show next word
            showNextWord();
        }

        // Word was skipped
        function skipWord() {
            // In individual mode, only explainer loses point
            if (gameState.gameMode === 'individual') {
                gameState.score[gameState.currentExplainer] = (gameState.score[gameState.currentExplainer] || 0) - 1;
            } else {
                // In team mode, team loses point
                gameState.score[gameState.currentTeam] = (gameState.score[gameState.currentTeam] || 0) - 1;
            }
            
            // Update scoreboard
            updateScoreboard();
            
            // Show next word
            showNextWord();
        }

        // End the current round
        function endRound() {
            // Disable buttons
            elements.correctBtn.disabled = true;
            elements.skipBtn.disabled = true;
            
            // Show round over message
            elements.wordDisplay.textContent = '–†–∞—É–Ω–¥ –æ–∫–æ–Ω—á–µ–Ω!';
            elements.wordDisplay.style.animation = 'none';
            
            // Check if game is over
            if (gameState.currentRound >= gameState.totalRounds) {
                endGame();
                return;
            }
            
            // Start next round after a delay
            setTimeout(() => {
                startRound();
            }, 3000);
        }

        // End the game and show winner
        function endGame() {
            let winner;
            let maxScore = -1;
            
            // Create final scoreboard
            elements.finalScoreboard.innerHTML = '';
            
            if (gameState.gameMode === 'individual') {
                // Sort players by score
                const sortedPlayers = [...gameState.players].sort((a, b) => {
                    return (gameState.score[b] || 0) - (gameState.score[a] || 0);
                });
                
                // Find winner and build final scoreboard
                sortedPlayers.forEach((player, index) => {
                    const score = gameState.score[player] || 0;
                    
                    // Check for winner
                    if (score > maxScore) {
                        maxScore = score;
                        winner = player;
                    } else if (score === maxScore) {
                        // In case of tie, add the player to winner string
                        winner = `${winner} –∏ ${player}`;
                    }
                    
                    // Add to final scoreboard
                    const playerElement = document.createElement('div');
                    playerElement.className = 'player-score';
                    
                    const positionSpan = document.createElement('span');
                    positionSpan.style.minWidth = '30px';
                    positionSpan.style.textAlign = 'center';
                    positionSpan.style.fontWeight = 'bold';
                    positionSpan.style.color = '#868e96';
                    positionSpan.textContent = `${index + 1}.`;
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'name';
                    nameSpan.textContent = player;
                    
                    const scoreSpan = document.createElement('span');
                    scoreSpan.className = 'score';
                    scoreSpan.textContent = score;
                    
                    playerElement.appendChild(positionSpan);
                    playerElement.appendChild(nameSpan);
                    playerElement.appendChild(scoreSpan);
                    elements.finalScoreboard.appendChild(playerElement);
                });
            } else {
                // Find winning team
                const team1Score = gameState.score['–ö–æ–º–∞–Ω–¥–∞ 1'] || 0;
                const team2Score = gameState.score['–ö–æ–º–∞–Ω–¥–∞ 2'] || 0;
                
                if (team1Score > team2Score) {
                    winner = '–ö–æ–º–∞–Ω–¥–∞ 1';
                    maxScore = team1Score;
                } else if (team2Score > team1Score) {
                    winner = '–ö–æ–º–∞–Ω–¥–∞ 2';
                    maxScore = team2Score;
                } else {
                    winner = '–ö–æ–º–∞–Ω–¥–∞ 1 –∏ –ö–æ–º–∞–Ω–¥–∞ 2 (–Ω–∏—á—å—è)';
                    maxScore = team1Score;
                }
                
                // Add teams to final scoreboard
                ['–ö–æ–º–∞–Ω–¥–∞ 1', '–ö–æ–º–∞–Ω–¥–∞ 2'].forEach((team, index) => {
                    const scoreElement = document.createElement('div');
                    scoreElement.className = 'team-score';
                    scoreElement.innerHTML = `
                        <h3>${team}</h3>
                        <p>${gameState.teams[index].join(', ')}</p>
                        <p style="font-size: 1.5rem; font-weight: bold; margin-top: 0.5rem; color: ${team === winner.split(' ')[0] ? 'var(--success-color)' : 'var(--primary-color)'};">
                            ${gameState.score[team] || 0} –æ—á–∫–æ–≤
                        </p>
                    `;
                    elements.finalScoreboard.appendChild(scoreElement);
                });
            }
            
            // Show winner screen
            elements.gameScreen.classList.remove('active');
            elements.winnerScreen.classList.add('active');
            elements.winnerName.textContent = `${winner}`;
            
            // Add score to winner name
            const winnerScore = document.createElement('div');
            winnerScore.style.fontSize = '1.5rem';
            winnerScore.style.color = '#868e96';
            winnerScore.textContent = `${maxScore} –æ—á–∫–æ–≤`;
            elements.winnerName.appendChild(winnerScore);
        }

        // Reset the game to initial state
        function resetGame() {
            gameState.currentRound = 0;
            gameState.score = {};
            gameState.selectedCategories = [];
            gameState.currentTeamIndex = 0;
            gameState.remainingWords = [];
            gameState.showFullResults = false;
            
            // Clear team selections
            if (gameState.gameMode === 'teams') {
                elements.team1.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 1</h3>';
                elements.team2.innerHTML = '<h3>–ö–æ–º–∞–Ω–¥–∞ 2</h3>';
                gameState.teams = [[], []];
            }
            
            // Clear player list
            elements.playerList.innerHTML = '';
            gameState.players = [];
            
            elements.winnerScreen.classList.remove('active');
            elements.playerSetupScreen.classList.add('active');
            
            // Set focus back to input
            elements.playerNameInput.focus();
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>